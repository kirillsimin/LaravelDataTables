{"version":3,"sources":["app.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"app.js","sourcesContent":["$(document).ready(function () {\n\n    /**\n    * Bands datatable\n    *****************************************************************/\n    var bandsTable = $('#bands').DataTable({\n        processing: true,\n        serverSide: true,\n        ajax: {\n            url: window.location.origin + '/bands/data',\n        },\n        columns: [\n            {data: 'name', name: 'name'},\n            {data: 'start_date', name: 'start_date'},\n            {data: 'website', name: 'website'},\n            {data: 'still_active', name: 'still_active', searchable: false},\n            {data: 'action', name: 'action', orderable: false, searchable: false}\n        ]\n    });\n\n    /**\n    * Albums datatable\n    *****************************************************************/\n    var albumsTable = $('#albums').DataTable({\n        processing: true,\n        serverSide: true,\n        ajax: {\n            url: window.location.origin + '/albums/data',\n            data: function (d) {\n                d.band_id = $('#band-search').val();\n            }\n        },\n        columns: [\n            {data: 'band_name', name: 'name'},\n            {data: 'album_name', name: 'albums.name'},\n            {data: 'recorded_date', name: 'recorded_date', searchable: false},\n            {data: 'release_date', name: 'release_date', searchable: false},\n            {data: 'number_of_tracks', name: 'number_of_tracks', searchable: false},\n            {data: 'label', name: 'label'},\n            {data: 'producer', name: 'producer'},\n            {data: 'genre', name: 'genre'},\n            {data: 'action', name: 'action', orderable: false, searchable: false}\n        ]\n    });\n\n    $('#band-search').off('change', function(){});\n    $('#band-search').on('change', function(e){\n        e.preventDefault();\n        albumsTable.draw();\n    });\n\n    /**\n    * Albums Select 2\n    *****************************************************************/\n    $('#band-search').select2({\n        allowClear: true,\n        minimumInputLength: 3,\n        initSelection: function (element, callback) {\n            var bandId = $('#band-search').data('band-id');\n            var bandName = $('#band-search').data('band-name');\n            callback({ id: bandId, text: bandName});\n        },\n        placeholder: \"Select band...\",\n        ajax: {\n            url: '/bands/search',\n            method: 'post',\n            dataType: 'json',\n            delay: 250,\n            data: function (params) {\n                var token = $('input[name=\"_token\"]').val();\n                return {\n                    term: params.term, // search term\n                    role_id: 2,\n                    _token: token\n                };\n            },\n            processResults: function (data) {\n                return {\n                    results: data\n                };\n            }\n        }\n    });\n\n    /**\n    * Init datepickers\n    *****************************************************************/\n    $('input[name=\"recorded-date\"').bootstrapMaterialDatePicker({ format : 'MM/DD/YYYY', currentDate: moment()});\n    $('input[name=\"release-date\"').bootstrapMaterialDatePicker({ format : 'MM/DD/YYYY', currentDate: moment()});\n    $('input[name=\"start-date\"').bootstrapMaterialDatePicker({ format : 'MM/DD/YYYY', currentDate: moment()});\n\n    /**\n    * Delete Band\n    *****************************************************************/\n    $(document).off('click', '.delete-band');\n    $(document).on('click', '.delete-band', function() {\n        var bandId = $(this).data('band-id');\n        $('.warning-modal-yes').off('click');\n        $('.warning-modal-yes').on('click', function() {\n            var token = $('input[name=\"_token\"]').val();\n            $.ajax({\n                url: '/bands/delete',\n                method: 'post',\n                data: {\n                    _token: token,\n                    band_id: bandId\n                },\n                dataType: 'json'\n            })\n            .always(function(){\n                $('#warning-modal').find('.message').html('');\n            })\n            .done(function(data){\n                console.log(data);\n                if (data.success == true) {\n                    $('#warning-modal').modal('hide');\n                    bandsTable.draw();\n                }\n                if (data.success == false) {\n                    console.log(data.message);\n                    $('#warning-modal').find('.message').html(data.message);\n                }\n            })\n            .fail(function(data){\n                $('#warning-modal').find('.message').html('Unexpected error occured.');\n                response = JSON.parse(data.responseText);\n                console.log(data, response);\n\n            });\n        });\n    });\n\n    /**\n    * Delete Album\n    *****************************************************************/\n    $(document).off('click', '.delete-album');\n    $(document).on('click', '.delete-album', function() {\n        var albumId = $(this).data('album-id');\n        $('.warning-modal-yes').off('click');\n        $('.warning-modal-yes').on('click', function() {\n            var token = $('input[name=\"_token\"]').val();\n            $.ajax({\n                url: '/albums/delete',\n                method: 'post',\n                data: {\n                    _token: token,\n                    album_id: albumId\n                },\n                dataType: 'json'\n            })\n            .always(function(){\n                $('#warning-modal').find('.message').html('');\n            })\n            .done(function(data){\n                console.log(data);\n                if (data.success == true) {\n                    $('#warning-modal').modal('hide');\n                    albumsTable.draw();\n                }\n                if (data.success == false) {\n                    console.log(data.message);\n                    $('#warning-modal').find('.message').html(data.message);\n                }\n            })\n            .fail(function(data){\n                $('#warning-modal').find('.message').html('Unexpected error');\n                response = JSON.parse(data.responseText);\n                console.log(data, response);\n            });\n        });\n    });\n\n    $('#save-album').off('click');\n    $('#save-album').on('click', function() {\n        var id = $('input[name=\"id\"]').val();\n        var token = $('input[name=\"_token\"]').val();\n        var bandId = $('#band-search').val();\n        if (bandId == null) {\n            bandId = $('#band-search').data('band-id'); // select2 doesn't play well with pre-selected Ajax\n        }\n        var name = $('input[name=\"name\"]').val();\n        var recordedDate = $('input[name=\"recorded-date\"]').val();\n        var releaseDate = $('input[name=\"release-date\"]').val();\n        var numberOfTracks = $('input[name=\"number-of-tracks\"]').val();\n        var albumLabel = $('input[name=\"album-label\"]').val();\n        var producer = $('input[name=\"producer\"]').val();\n        var genre = $('input[name=\"genre\"]').val();\n        $.ajax({\n            url: '/albums/save',\n            method: 'post',\n            data: {\n                _token: token,\n                id: id,\n                band_id: bandId,\n                name: name,\n                recorded_date: recordedDate,\n                release_date: releaseDate,\n                number_of_tracks: numberOfTracks,\n                album_label: albumLabel,\n                producer: producer,\n                genre: genre\n            },\n            dataType: 'json'\n        })\n        .always(function(){\n            $('.has-error').removeClass('has-error');\n            $('.help-block').html('');\n            $('#save-album-message').html('');\n        })\n        .done(function(data){\n            console.log(data);\n            if (data.success === true) {\n                // populates id with newly created album, so it doesn't get created twice\n                $('input[name=\"id\"]').val(data.album_id);\n            }\n            if (data.name) {\n                $('.album-name').addClass('has-error');\n                $('.album-name').find('.help-block').html(data.name[0]);\n            }\n            // example of further validation\n            // if (data.number_of_tracks) {\n            //     $('.number-of-tracks').addClass('has-error');\n            //     $('.number-of-tracks').find('.help-block').html(data.number_of_tracks[0]);\n            // }\n            $('#save-album-message').html(data.message);\n        })\n        .fail(function(data){\n            $('#save-album-message').html('Something went wrong.');\n        });\n    });\n\n    $('#save-band').off('click');\n    $('#save-band').on('click', function() {\n        var id = $('input[name=\"id\"]').val();\n        var token = $('input[name=\"_token\"]').val();\n        var name = $('input[name=\"name\"]').val();\n        var startDate = $('input[name=\"recorded-date\"]').val();\n        var website = $('input[name=\"website\"]').val();\n        var stillActive = $('select[name=\"still-active\"]').val();\n        $.ajax({\n            url: '/bands/save',\n            method: 'post',\n            data: {\n                _token: token,\n                id: id,\n                name: name,\n                start_date: startDate,\n                website: website,\n                still_active: stillActive\n            },\n            dataType: 'json'\n        })\n        .always(function(){\n            $('.has-error').removeClass('has-error');\n            $('.help-block').html('');\n            $('#save-band-message').html('');\n        })\n        .done(function(data){\n            console.log(data);\n            if (data.success === true) {\n                $('input[name=\"id\"]').val(data.album_id);\n            }\n            if (data.name) {\n                $('.name').addClass('has-error');\n                $('.name').find('.help-block').html(data.name[0]);\n            }\n            $('#save-band-message').html(data.message);\n        })\n        .fail(function(data){\n            $('#save-band-message').html('Something went wrong.');\n        });\n    });\n\n});"]}